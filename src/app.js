document.addEventListener("alpine:init", initAlpineData);

function initAlpineData() {
  Alpine.data("grader", () => ({
    display: { loader: false, form: false, contentScore: true, graderHeader: true, recommendations: true, error: false },
    recommendations: {
      topics: [{
        "p": "base",
        "pr": 83,
        "v": [],
        "count": 7,
        "x": 15,
        "locations": [
          {
            "e": 6,
            "s": 3
          },
          {
            "e": 49,
            "s": 46
          },
          {
            "e": 192,
            "s": 189
          },
          {
            "e": 300,
            "s": 297
          },
          {
            "e": 305,
            "s": 302
          },
          {
            "e": 344,
            "s": 341
          },
          {
            "e": 401,
            "s": 398
          }
        ],
        "id": 2844609
      },
      {
        "p": "images",
        "pr": 75,
        "v": [
          "image"
        ],
        "count": 3,
        "x": 7,
        "locations": [
          {
            "e": 13,
            "s": 9
          },
          {
            "e": 55,
            "s": 51
          },
          {
            "e": 85,
            "s": 81
          }
        ],
        "id": 2844610
      },
      {
        "p": "data",
        "pr": 45,
        "v": [],
        "x": 4,
        "count": 12,
        "locations": [
          {
            "e": 3,
            "s": 0
          },
          {
            "e": 18,
            "s": 15
          },
          {
            "e": 36,
            "s": 33
          },
          {
            "e": 154,
            "s": 151
          },
          {
            "e": 165,
            "s": 162
          },
          {
            "e": 170,
            "s": 167
          },
          {
            "e": 197,
            "s": 194
          },
          {
            "e": 453,
            "s": 450
          },
          {
            "e": 572,
            "s": 569
          },
          {
            "e": 577,
            "s": 574
          },
          {
            "e": 582,
            "s": 579
          },
          {
            "e": 929,
            "s": 926
          }
        ],
        "id": 2844611
      },
      {
        "p": "string",
        "pr": 37,
        "v": [
          "strings"
        ],
        "count": 1,
        "x": 2,
        "locations": [
          {
            "e": 294,
            "s": 289
          }
        ],
        "id": 2844613
      },
      {
        "p": "file",
        "pr": 37,
        "v": [
          "files"
        ],
        "count": 3,
        "x": 2,
        "locations": [
          {
            "e": 91,
            "s": 87
          },
          {
            "e": 325,
            "s": 322
          },
          {
            "e": 429,
            "s": 426
          }
        ],
        "id": 2844612
      },
      {
        "p": "binary data",
        "pr": 33,
        "v": [],
        "x": 3,
        "count": 1,
        "locations": [
          {
            "e": 453,
            "s": 443
          }
        ],
        "id": 2844614
      },
      {
        "p": "example",
        "pr": 25,
        "v": [],
        "count": 2,
        "x": 6,
        "locations": [
          {
            "e": 461,
            "s": 455
          },
          {
            "e": 937,
            "s": 931
          }
        ],
        "id": 2844617
      },
      {
        "p": "website",
        "pr": 25,
        "v": [
          "websites"
        ],
        "count": 1,
        "x": 2,
        "locations": [
          {
            "e": 831,
            "s": 825
          }
        ],
        "id": 2844616
      },
      {
        "p": "gif",
        "pr": 25,
        "v": [],
        "count": 2,
        "x": 1,
        "locations": [
          {
            "e": 606,
            "s": 604
          },
          {
            "e": 842,
            "s": 840
          }
        ],
        "id": 2844615
      },
      {
        "p": "tool",
        "pr": 20,
        "v": [],
        "x": 3,
        "count": 1,
        "locations": [
          {
            "e": 611,
            "s": 608
          }
        ],
        "id": 2844621
      },
      {
        "p": "data URI",
        "pr": 20,
        "v": [
          "data uris"
        ],
        "count": 1,
        "x": 3,
        "locations": [
          {
            "e": 7,
            "s": 0
          }
        ],
        "id": 2844620
      },
      {
        "p": "image files",
        "pr": 20,
        "v": [
          "image file"
        ],
        "x": 2,
        "count": 1,
        "locations": [
          {
            "e": 91,
            "s": 81
          }
        ],
        "id": 2844619
      },
      {
        "p": "png",
        "pr": 20,
        "v": [],
        "count": 3,
        "x": 1,
        "locations": [
          {
            "e": 2,
            "s": 0
          },
          {
            "e": 224,
            "s": 222
          },
          {
            "e": 615,
            "s": 613
          }
        ],
        "id": 2844618
      },
      {
        "p": "HTML",
        "pr": 16,
        "v": [],
        "count": 1,
        "x": 3,
        "locations": [
          {
            "e": 7,
            "s": 4
          }
        ],
        "id": 2844626
      },
      {
        "p": "web browser",
        "pr": 16,
        "v": [
          "web browsers"
        ],
        "count": 1,
        "x": 2,
        "locations": [
          {
            "e": 61,
            "s": 51
          }
        ],
        "id": 2844625
      },
      {
        "p": "image data",
        "pr": 16,
        "v": [],
        "x": 2,
        "count": 1,
        "locations": [
          {
            "e": 18,
            "s": 9
          }
        ],
        "id": 2844624
      },
      {
        "p": "plain text",
        "pr": 16,
        "v": [],
        "x": 2,
        "count": 1,
        "locations": [
          {
            "e": 49,
            "s": 40
          }
        ],
        "id": 2844623
      },
      {
        "p": "jpg",
        "pr": 16,
        "v": [],
        "count": 1,
        "x": 1,
        "locations": [
          {
            "e": 22,
            "s": 20
          }
        ],
        "id": 2844622
      },
      {
        "p": "bits",
        "pr": 12,
        "v": [],
        "count": 1,
        "x": 12,
        "locations": [
          {
            "e": 27,
            "s": 24
          }
        ],
        "id": 2844637
      },
      {
        "p": "characters",
        "pr": 12,
        "v": [],
        "count": 1,
        "x": 11,
        "locations": [
          {
            "e": 38,
            "s": 29
          }
        ],
        "id": 2844636
      },
      {
        "p": "format",
        "pr": 12,
        "v": [
          "formats"
        ],
        "x": 2,
        "count": 1,
        "locations": [
          {
            "e": 68,
            "s": 63
          }
        ],
        "id": 2844635
      },
      {
        "p": "way",
        "pr": 12,
        "v": [],
        "x": 2,
        "count": 1,
        "locations": [
          {
            "e": 619,
            "s": 617
          }
        ],
        "id": 2844634
      },
      {
        "p": "blog",
        "pr": 12,
        "v": [
          "blogs"
        ],
        "count": 1,
        "x": 2,
        "locations": [
          {
            "e": 73,
            "s": 70
          }
        ],
        "id": 2844633
      },
      {
        "p": "file size",
        "pr": 12,
        "v": [],
        "count": 1,
        "x": 2,
        "locations": [
          {
            "e": 330,
            "s": 322
          }
        ],
        "id": 2844630
      },
      {
        "p": "text",
        "pr": 12,
        "v": [],
        "x": 2,
        "count": 2,
        "locations": [
          {
            "e": 49,
            "s": 46
          },
          {
            "e": 159,
            "s": 156
          }
        ],
        "id": 2844631
      },
      {
        "p": "bytes",
        "pr": 12,
        "v": [
          "byte"
        ],
        "count": 1,
        "x": 2,
        "locations": [
          {
            "e": 79,
            "s": 75
          }
        ],
        "id": 2844632
      },
      {
        "p": "form",
        "pr": 12,
        "v": [],
        "x": 1,
        "count": 0,
        "locations": [],
        "id": 2844627
      },
      {
        "p": "bugs",
        "pr": 12,
        "v": [
          "bug"
        ],
        "count": 0,
        "x": 1,
        "locations": [],
        "id": 2844628
      },
      {
        "p": "text files",
        "pr": 12,
        "v": [
          "text file"
        ],
        "count": 0,
        "x": 1,
        "locations": [],
        "id": 2844629
      },
      {
        "p": "encoding",
        "pr": 8,
        "v": [],
        "count": 0,
        "x": 9,
        "locations": [],
        "id": 2844686
      },
      {
        "p": "alphabet",
        "pr": 8,
        "v": [],
        "count": 0,
        "x": 5,
        "locations": [],
        "id": 2844685
      },
      {
        "p": "Data URL",
        "pr": 8,
        "v": [
          "data urls"
        ],
        "x": 4,
        "count": 0,
        "locations": [],
        "id": 2844684
      },
      {
        "p": "encoded string",
        "pr": 8,
        "v": [],
        "count": 0,
        "x": 4,
        "locations": [],
        "id": 2844682
      },
      {
        "p": "schemes",
        "pr": 8,
        "v": [
          "scheme"
        ],
        "x": 4,
        "count": 0,
        "locations": [],
        "id": 2844683
      },
      {
        "p": "GitHub",
        "pr": 8,
        "v": [],
        "count": 0,
        "x": 3,
        "locations": [],
        "id": 2844681
      },
      {
        "p": "server",
        "pr": 8,
        "v": [],
        "x": 3,
        "count": 0,
        "locations": [],
        "id": 2844679
      },
      {
        "p": "browser",
        "pr": 8,
        "v": [],
        "x": 3,
        "count": 1,
        "locations": [
          {
            "e": 61,
            "s": 55
          }
        ],
        "id": 2844678
      },
      {
        "p": "web",
        "pr": 8,
        "v": [],
        "x": 3,
        "count": 1,
        "locations": [
          {
            "e": 53,
            "s": 51
          }
        ],
        "id": 2844680
      },
      {
        "p": "\u0001F",
        "pr": 8,
        "v": [],
        "x": 2,
        "count": 0,
        "locations": [],
        "id": 2844675
      },
      {
        "p": "post",
        "pr": 8,
        "v": [],
        "x": 2,
        "count": 0,
        "locations": [],
        "id": 2844676
      },
      {
        "p": "binary-to-text",
        "pr": 8,
        "v": [],
        "count": 0,
        "x": 2,
        "locations": [],
        "id": 2844677
      },
      {
        "p": "fact",
        "pr": 8,
        "v": [],
        "count": 0,
        "x": 2,
        "locations": [],
        "id": 2844670
      },
      {
        "p": "ASCII",
        "pr": 8,
        "v": [],
        "count": 0,
        "x": 2,
        "locations": [],
        "id": 2844669
      },
      {
        "p": "CSS",
        "pr": 8,
        "v": [],
        "count": 0,
        "x": 2,
        "locations": [],
        "id": 2844668
      },
      {
        "p": "converter",
        "pr": 8,
        "v": [],
        "x": 2,
        "count": 0,
        "locations": [],
        "id": 2844667
      },
      {
        "p": "64-encoded images",
        "pr": 8,
        "v": [
          "64-encoded image"
        ],
        "count": 0,
        "x": 2,
        "locations": [],
        "id": 2844666
      },
      {
        "p": "Converters",
        "pr": 8,
        "v": [
          "converter"
        ],
        "count": 0,
        "x": 2,
        "locations": [],
        "id": 2844673
      },
      {
        "p": "code",
        "pr": 8,
        "v": [],
        "x": 2,
        "count": 0,
        "locations": [],
        "id": 2844672
      },
      {
        "p": "web servers",
        "pr": 8,
        "v": [
          "web server"
        ],
        "x": 2,
        "count": 0,
        "locations": [],
        "id": 2844674
      },
      {
        "p": "encoder",
        "pr": 8,
        "v": [],
        "x": 2,
        "count": 1,
        "locations": [
          {
            "e": 258,
            "s": 252
          }
        ],
        "id": 2844671
      },
      {
        "p": "World Wide Web",
        "pr": 8,
        "v": [],
        "x": 1,
        "count": 0,
        "locations": [],
        "id": 2844656
      },
      {
        "p": "group of binary-to-text",
        "pr": 8,
        "v": [],
        "count": 0,
        "x": 1,
        "locations": [],
        "id": 2844655
      },
      {
        "p": "6-bit Base",
        "pr": 8,
        "v": [],
        "count": 0,
        "x": 1,
        "locations": [],
        "id": 2844654
      },
      {
        "p": "element",
        "pr": 8,
        "v": [],
        "x": 1,
        "count": 0,
        "locations": [],
        "id": 2844653
      },
      {
        "p": "Latin letters",
        "pr": 8,
        "v": [],
        "count": 0,
        "x": 1,
        "locations": [],
        "id": 2844652
      },
      {
        "p": "encoding algorithm",
        "pr": 8,
        "v": [],
        "x": 1,
        "count": 0,
        "locations": [],
        "id": 2844651
      },
      {
        "p": "answers",
        "pr": 8,
        "v": [],
        "x": 1,
        "count": 0,
        "locations": [],
        "id": 2844650
      },
      {
        "p": "small images",
        "pr": 8,
        "v": [],
        "count": 0,
        "x": 1,
        "locations": [],
        "id": 2844649
      },
      {
        "p": "Linux",
        "pr": 8,
        "v": [],
        "count": 0,
        "x": 1,
        "locations": [],
        "id": 2844648
      },
      {
        "p": "MAC",
        "pr": 8,
        "v": [],
        "count": 0,
        "x": 1,
        "locations": [],
        "id": 2844647
      },
      {
        "p": "Windows",
        "pr": 8,
        "v": [],
        "x": 1,
        "count": 0,
        "locations": [],
        "id": 2844646
      },
      {
        "p": "parts",
        "pr": 8,
        "v": [],
        "count": 0,
        "x": 1,
        "locations": [],
        "id": 2844645
      },
      {
        "p": "additional HTTP requests",
        "pr": 8,
        "v": [],
        "x": 1,
        "count": 0,
        "locations": [],
        "id": 2844644
      },
      {
        "p": "user experience",
        "pr": 8,
        "v": [],
        "x": 1,
        "count": 0,
        "locations": [],
        "id": 2844643
      },
      {
        "p": "SVG",
        "pr": 8,
        "v": [],
        "count": 0,
        "x": 1,
        "locations": [],
        "id": 2844642
      },
      {
        "p": "BMP",
        "pr": 8,
        "v": [],
        "x": 1,
        "count": 0,
        "locations": [],
        "id": 2844640
      },
      {
        "p": "upload",
        "pr": 8,
        "v": [],
        "count": 0,
        "x": 1,
        "locations": [],
        "id": 2844639
      },
      {
        "p": "user",
        "pr": 8,
        "v": [],
        "x": 1,
        "count": 0,
        "locations": [],
        "id": 2844638
      },
      {
        "p": "page",
        "pr": 8,
        "v": [],
        "x": 1,
        "count": 1,
        "locations": [
          {
            "e": 857,
            "s": 854
          }
        ],
        "id": 2844641
      },
      {
        "p": "ad",
        "pr": 8,
        "v": [
          "ads"
        ],
        "x": 1,
        "count": 11,
        "locations": [
          {
            "e": 1,
            "s": 0
          },
          {
            "e": 70,
            "s": 68
          },
          {
            "e": 74,
            "s": 72
          },
          {
            "e": 96,
            "s": 94
          },
          {
            "e": 103,
            "s": 102
          },
          {
            "e": 106,
            "s": 105
          },
          {
            "e": 111,
            "s": 110
          },
          {
            "e": 115,
            "s": 114
          },
          {
            "e": 118,
            "s": 117
          },
          {
            "e": 156,
            "s": 154
          },
          {
            "e": 602,
            "s": 601
          }
        ],
        "id": 2844661
      },
      {
        "p": "drag",
        "pr": 8,
        "v": [],
        "count": 1,
        "x": 1,
        "locations": [
          {
            "e": 41,
            "s": 38
          }
        ],
        "id": 2844665
      },
      {
        "p": "HTML files",
        "pr": 8,
        "v": [
          "html file"
        ],
        "x": 1,
        "count": 0,
        "locations": [],
        "id": 2844664
      },
      {
        "p": "application",
        "pr": 8,
        "v": [
          "applications"
        ],
        "count": 0,
        "x": 1,
        "locations": [],
        "id": 2844663
      },
      {
        "p": "links",
        "pr": 8,
        "v": [
          "link"
        ],
        "count": 0,
        "x": 1,
        "locations": [],
        "id": 2844662
      },
      {
        "p": "use",
        "pr": 8,
        "v": [
          "uses"
        ],
        "x": 1,
        "count": 0,
        "locations": [],
        "id": 2844660
      },
      {
        "p": "Calculators",
        "pr": 8,
        "v": [
          "calculator"
        ],
        "x": 1,
        "count": 0,
        "locations": [],
        "id": 2844659
      },
      {
        "p": "notes",
        "pr": 8,
        "v": [
          "note"
        ],
        "count": 1,
        "x": 1,
        "locations": [
          {
            "e": 551,
            "s": 548
          }
        ],
        "id": 2844658
      },
      {
        "p": "online tool",
        "pr": 8,
        "v": [
          "online tools"
        ],
        "x": 1,
        "count": 0,
        "locations": [],
        "id": 2844657
      }],
      phraseHighlighting: true, sortBy: 'Priority',
      sortByHandler() { sortRecommendations(this); }
    },
    contentScore: {
      recommended_word_count: 0,
      recommendedTermsTotal: 0,
      currentWordCount: 0,
      score: { grade: 'Poor', score: 0, color: 'grader-poor' },
      markers: { start: '', fair: '', good: '', great: '', greatest: '', end: '' },
      readability: { current: 'Graduate', recomended: 'Graduate' }
    },
    graderHeader: { keyword_brief: 'Brief', graderUrl: 'paste your grader url', graderPath: 'paste grader url' },
    error: { message: '' },
    preloadGrader() {
      var _this = this;
      // _this.display.loader = true;
      // google.script.run
      //   .withSuccessHandler(function (response) { fetchGraderSuccessHandler(response, _this); })
      //   .withFailureHandler(function (msg) { console.log(msg); })
      //   .preloadGrader();
    },
    toggleHighlight(event) {
      var _this = this;
      _this.recommendations.phraseHighlighting = !_this.recommendations.phraseHighlighting;

      // if (_this.recommendations.phraseHighlighting) {
      //   this.findPhrasesAndGrade('true');
      // } else {
      //   this.unHighlight();
      // }
    },
    toggleForm() {
      this.display.form = !this.display.form;
      this.display.contentScore = !this.display.form;
      this.display.recommendations = !this.display.form;
    },
    fetchGrader() {
      var _this = this, _url = validateAndFormatGraderUrl(this.graderHeader.graderPath);
      // _this.display.loader = true;
      // google.script.run
      //   .withSuccessHandler(function (response) { fetchGraderSuccessHandler(response, _this); })
      //   .withFailureHandler(function (msg) { console.log(msg); })
      //   .getGraderTopics(_url);
    },
    findPhrasesAndGrade(phHighlighting = 'true') {
      var _this = this, msg = 'Phrases highlighted';
      // _this.display.loader = true;
      // google.script.run
      //   .withSuccessHandler(function (response) { gradeTopicsSuccessHandler(response, _this); })
      //   .withFailureHandler(function (msg) { _this.display.loader = false; })
      //   .findPhrases(_this.recommendations.topics, phHighlighting);
    },
    findPhrasesAndGradeBackground(phHighlighting = 'true') {
      var _this = this;
      // google.script.run
      //   .withSuccessHandler(function (response) { _this.recommendations.topics = response; })
      //   .withFailureHandler(function (msg) { })
      //   .findPhrases(_this.recommendations.topics, phHighlighting);
    },
    unHighlight() {
      var _this = this, msg = 'Phrases unhilighted';
      // _this.display.loader = true;

      // google.script.run
      //   .withSuccessHandler(function (response) { gradeTopicsSuccessHandler(response, _this); })
      //   .withFailureHandler(function (msg) { _this.display.loader = false; })
      //   .removeHighlighting('false');
    }
  }));
}

function runEveryFiveSeconds(_this) {
  console.log('runEveryFiveSeconds: ' + _this.recommendations.phraseHighlighting.toString());
  _this.findPhrasesAndGradeBackground(_this.recommendations.phraseHighlighting.toString());

  if (validateAndFormatGraderUrl(_this.graderHeader.graderPath)) {
    setTimeout(function () {
      runEveryFiveSeconds(_this);
    }, 10000);
  }
}

function validateAndFormatGraderUrl(graderUrl) {
  try {
    url = graderUrl.match(/https:\/\/?([a-z0-9\-\_]){3,32}\.([a-z0-9\-\_]){3,32}\.[a-z0-9]{2,10}?\/l\/[0-9a-z]{32}/);
    return `${url[0]}/google-docs-grader.json`;
  } catch (err) {
    alert('That looks like an invalid brief/grader public link, try a new one');
    return null;
  }
}

function gradeTopicsSuccessHandler(response, _this) {
  _this.display.loader = false;
}

function sortRecommendations(_this) {
  if (_this.sortBy == 'Priority') {
    _this.topics = _this.topics.sort((a, b) => { return parseInt(b.pr) - parseInt(a.pr); });
  } else {
    _this.topics = _this.topics.sort((a, b) => { return parseInt(b.count) - parseInt(a.count); });
  }
  // uncomment below if we need to persist the sortBy property on the doc
  // google.script.run.withSuccessHandler(function(response){}).withFailureHandler(function(msg){}).setSortByPreference(_this.sortBy);
}

function fetchGraderSuccessHandler(response, _this) {
  console.log(response);
  if (response != {}) {
    _this.display.loader = _this.display.form = false;
    _this.recommendations.topics = response.topics;
    _this.recommendations.sortBy = response.sortBy;
    _this.display.recommendations = true;

    if (response.graderUrl) {
      _this.graderHeader.graderUrl = response.graderUrl;
      _this.graderHeader.graderPath = response.graderUrl.replace('google-docs-grader.json', 'grader');
      _this.graderHeader.keyword_brief = response.keyword_brief;
      _this.display.graderHeader = true;
    }

    _this.grading = response.grader;
    _this.contentScore.recommended_word_count = response.grader.recommended_word_count;
    _this.contentScore.currentWordCount = words(response.bodyText);
    _this.contentScore.readability.current = gradeFromText(response.bodyText);
    _this.contentScore.readability.recomended = gradeFromScore(response.grader.recommended_readability);

    /** calculate content score */
    var wcScore = wordCountScore(_this.contentScore.currentWordCount, _this.contentScore.recommended_word_count);
    var phScore = phraseScore(response.topics);
    _this.contentScore.score = contentScore(response.topics, wcScore);
    console.log(_this.contentScore.score);
    _this.contentScore.markers = contentScoreProgressMarkers(_this.contentScore.score);
    _this.contentScore.topicsUsed = response.topicsUsed;
    _this.contentScore.grade = gradeFromText(response.bodyText);
    _this.contentScore.recommendedTermsTotal = response.topics.length;
    _this.display.contentScore = true;
    _this.recommendations.phraseHighlighting = (response.phraseHighlighting === 'true');

    // runEveryFiveSeconds(_this);
  }
}
/** Content Score Calculator */

function wordCountScore(currentWordCount, recommendedWordCount) {
  if (currentWordCount == 0 || recommendedWordCount == 0) { return 0; }
  return ((currentWordCount / recommendedWordCount) * 10).toFixed(2);
}

function phraseScore(topics) {
  let phrasesUsedWeightedScore = 0, totalPossibleWeightedScore = 0;

  topics.forEach(function (topic) {
    if (topic.count > 0) { phrasesUsedWeightedScore += topic.pr }
    totalPossibleWeightedScore += topic.pr;
  })

  return ((phrasesUsedWeightedScore / totalPossibleWeightedScore) * 90).toFixed(2);
}

function contentScore(topics, wcScore) {
  const phScore = phraseScore(topics);
  const score = parseFloat(wcScore) + parseFloat(phScore);
  const label = contentScoreLabel(score), color = contentScoreColor(label);
  return { score, label, color };
}

function contentScoreLabel(score) {
  const scoreRanges = [
    { min: 0, max: 20, label: 'Poor' },
    { min: 21, max: 50, label: 'Fair' },
    { min: 51, max: 70, label: 'Good' },
    { min: 71, max: 90, label: 'Great' },
    { min: 91, max: 100, label: 'Greatest 💯' }
  ];
  if (score < 0 || score > 100) { return '-'; }

  for (const range of scoreRanges) {
    if (score >= range.min && score <= range.max) { return range.label; }
  }

  return '-';
}

function contentScoreColor(scoreLabel) {
  const colorMap = { 'Poor': 'grader-poor', 'Fair': 'grader-fair', 'Good': 'grader-good', 'Great': 'grader-great', 'Greatest 💯': 'grader-greatest' };
  return colorMap[scoreLabel] || '';
}

function contentScoreProgressMarkers(score) {
  const bars = [
    { scoreLabel: 'start', val: 0 },
    { scoreLabel: 'fair', val: 21 },
    { scoreLabel: 'good', val: 51 },
    { scoreLabel: 'great', val: 71 },
    { scoreLabel: 'greatest', val: 91 },
    { scoreLabel: 'end', val: 100 }
  ];
  const markers = { start: '', fair: '', good: '', great: '', greatest: '', end: '' };

  bars.forEach(({ scoreLabel, klass, val }) => {
    markers[scoreLabel] = score.score >= val ? score.color : '';
  });

  return markers;
}
/** Content Score Calculator ends here*/